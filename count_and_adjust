#include <Shieldbot.h>

Shieldbot shieldbot = Shieldbot();

int rightSensorValue;
int leftSensorValue;

volatile int countRight= 0;
volatile int countLeft = 0;

bool lfBlackL = true;
bool lfWhiteL = true;
bool lfBlackR = true;
bool lfWhiteR = true;

int leftSpeed=50;
int rightSpeed=50;
void setup() {
  // initialize serial communication at 9600 bits per second:
  Serial.begin(9600); 
}

// the loop routine runs over and over again forever:
void loop() {
  // read the input on analog pin 5 from the sensor on the right wheel:
  rightSensorValue =analogRead(A5);
  // read the input on analog pin 4 from the sensor on the left wheel:
  leftSensorValue = analogRead(A4);

  check();
  leftSpeed = constrain(leftSpeed, 47, 60);  // should theoretically constrain the variables value to be between the 2 values listed
  rightSpeed = constrain(rightSpeed, 40, 53); // should theoretically constrain the variables value to be between the 2 values listed
  shieldbot.drive(leftSpeed,rightSpeed);

  Serial.print("Right:"); //label for the Right wheel sensor
  Serial.print(rightSpeed); //prints the output of the rightSpeed
  Serial.print(',');
  Serial.print("Left:"); //label for the Left wheel sensor
  Serial.println(leftSpeed); //prints the output of the leftSpeed

  delay(10);
}
void rightEdge(){

  if (rightSensorValue>=40 && lfBlackR==true)
  {
     // black colour detected
    lfBlackR = false;
    lfWhiteR = true;
    countRight++; //the counter of the right wheel is increased by 1
  }
  else if(rightSensorValue<40 && lfWhiteR ==true)
  {
    // white colour detected
    lfBlackR=true;
    lfWhiteR= false;
  }
}
/* The following function is counting when the sensor value i avove 90 wich means that black is detected 
 *  and for a sesor value under 90, white clour is detected
 * The function checks for transition between the white and black sections on the left wheel
 */
void leftEdge(){
  if (leftSensorValue>=40 && lfBlackL==true)
  {
     // black colour detected
    lfBlackL = false;
    lfWhiteL = true;
    countLeft++; //the counter of teh left wheel is increased by 1
  }
  else if(leftSensorValue<40 && lfWhiteL ==true)
  {
    // white colour detected
    lfBlackL=true;
    lfWhiteL = false;
  }
}
/*The function checkLeft() checks if the speed on the Left wheel is greather than the one on the Right Wheel
 * and accordinglu decreases the speed on Left wheel and increases the speed on the Right Wheel
 */
  void check()
 {
  leftEdge();
  rightEdge();
  
    if(countRight < countLeft)
    { 
      leftSpeed=leftSpeed--;  //decrease left speed
      rightSpeed=rightSpeed+2; //increase right speed             
    }
    else if(countRight > countLeft)
    { 
      leftSpeed=leftSpeed+2;  //decrease left speed
      rightSpeed=rightSpeed--; //increase right speed              
    }
  
 }
